[toc]

# 包管理工具

## 一. npm

既是包管理工具, 也是registry仓库

本地具有一个缓存, 会优先查找缓存里是否有需要的包



属性:

- private属性, 为true时可以防止误操作npm发布项目
- dependencies: 无论开发环境还是生成环境都需要依赖的包
- devDependencies: 在生成环境不需要的包,如: webpack, babel `npm install webpack --save-dev(-D)`
- peerDependencies: 需要使用这个库,必须安装的库



版本规范 x.y.z

- x: 主版本号
- y: 次版本号
- z: 修订号



- package.json里记录了较为宽松的版本
- package-lock.json里记录了特定严格的版本, 以解决不同开发人员合作开发下载库版本不同的问题



## 二. npx

1. 优先查找使用node_modules/.bin目录下的命令
2. 免安装全局命令: 对于那些只需要执行一次的命令, 可以使用npx,运行后就会删除

3. **不加npx, 先找到的是全局, 加npx才能使用局部的包, webpack除外**

- 去`node_modules/.bin`路径检查`npx`后的命令是否存在，找到之后执行；

- 找不到，就去环境变量`$PATH`里面，检查`npx`后的命令是否存在，找到之后执行;

- 还是找不到，自动下载一个临时的依赖包最新版本在一个临时目录，然后再运行命令，运行完之后删除，不污染全局环境。



## 三. yarn工具

- yarn时为了弥补早期npm的一些缺陷而出现的
- 使用方式与npm相似



## 四. cnpm工具

- 中国使用, 有些情况下我们无法很好的从registry下载
- taobao的镜像服务器仓库 --> npm config set registry "url"将库换为taobao的, 之后安装库的时候都默认从镜像服务器安装



## 五. 上传npm

需要生成一个package.json的文件

```js
{
    "name": "发布出去的名字"
    ...
    "keywords": ["xx","aa"],
    "license": "MIT"
}
```

1. 注册账号
2. npm login
3. npm publish



## 六. pnpm

[pnpm](https://pnpm.io/zh/motivation)

performant npm 高性能的npm, 速度快,能节省磁盘空间的软件包管理器, 如果有100个项目, 每个项目都有一个相同的依赖包, 那么磁盘就需要保存100份相同依赖包的副本

### 1. 软连接和硬链接

**硬链接( hard link )**

- 电脑文件系统中的多个文件平等的共享同一个文件存储单元
- 删除一个文件名字后, 还可以使用其他名字继续访问该文件

**软连接(符号连接)**

- 符号链接是一类特殊的文件
- 包含有以一条绝对路径或者相对路径的形式指向其他文件或者目录的引用
- 如: 快捷方式

![Snipaste_2022-12-20_19-45-14](.\图片\Snipaste_2022-12-20_19-45-14.png)

- 创建硬链接:
  - window:  `mklink /H [新建文件命] [要复制的文件]`
  - macos: `ln [要复制的文件] [新建文件命]`
- 创建软连接:
  - 无法在新建的文件中修改
  - window: `mklink [新建文件命] [要复制的文件名]`
  - macos: `ln -S [要复制的文件命] [新建文件命]`



### 2. pnpm的作用

- 如果你对同一依赖包使用相同的版本, 那么磁盘上只有这个依赖包的一份文件, 而不是100份

- 版本不同的依赖包会被分别存储

- 所有的文件保存在硬盘的统一位置, 使用了硬连接

  

### 3. 使用pnpm

- 非扁平化, 包与包的依赖并不是全在顶层, 在node_modules顶层中生成的文件夹为符号连接, 真实的文件在顶层pnpm文件夹下

- 下载`npm i pnpm -g`
- 添加: `pnpm add axios`

![Snipaste_2022-12-20_21-13-52](.\图片\Snipaste_2022-12-20_21-13-52.png)

| npm 命令                     | pnpm 命令                  |
| ---------------------------- | -------------------------- |
| npm install                  | pnpm install               |
| npm install [package name]   | pnpm add [package name]    |
| npm uninstall [package name] | pnpm remove [package name] |
| npm run [script]             | pnpm [script]              |



- pnpm-store 硬链接的总仓库 , 通过`pnpm store path`获取store文件路径